<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØµÙ…ÙŠÙ… Ù…Ø¬ÙˆÙ‡Ø±Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Hamdo</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">Ham<span>do</span></a>
            <nav>
                <ul>
                    <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="products.html">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                    <li><a href="ai-design.html">ØªØµÙ…ÙŠÙ… AI</a></li>
                    <li><a href="cart.html">Ø§Ù„Ø³Ù„Ø©</a></li>
                    <li><a href="orders.html">Ø·Ù„Ø¨Ø§ØªÙŠ</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <a href="login.html" id="login-btn" class="btn btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                <button id="logout-btn" class="btn btn-secondary" style="display: none;" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
    </header>

    <section class="ai-design-section">
        <div class="container">
            <h2 class="section-title">âœ¨ ØµÙ…Ù… Ù…Ø¬ÙˆÙ‡Ø±Ø§ØªÙƒ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h2>
            <p style="text-align: center; margin-bottom: 40px; color: #666;">
                Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§ ÙˆØ¯Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØµÙ…Ù… Ù„Ùƒ Ù‚Ø·Ø¹Ø© ÙØ±ÙŠØ¯Ø©
            </p>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start;">
                <div class="form-container" style="margin: 0;">
                    <form id="ai-design-form">
                        <div class="design-options">
                            <div class="form-group">
                                <label for="type">Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                                <select id="type" required>
                                    <option value="Ring">Ø®Ø§ØªÙ…</option>
                                    <option value="Necklace">Ù‚Ù„Ø§Ø¯Ø©</option>
                                    <option value="Bracelet">Ø³ÙˆØ§Ø±</option>
                                    <option value="Earrings">Ø£Ù‚Ø±Ø§Ø·</option>
                                    <option value="Pendant">ØªØ¹Ù„ÙŠÙ‚Ø©</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="material">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                                <select id="material" required>
                                    <option value="Gold">Ø°Ù‡Ø¨</option>
                                    <option value="Silver">ÙØ¶Ø©</option>
                                    <option value="White Gold">Ø°Ù‡Ø¨ Ø£Ø¨ÙŠØ¶</option>
                                    <option value="Rose Gold">Ø°Ù‡Ø¨ ÙˆØ±Ø¯ÙŠ</option>
                                    <option value="Platinum">Ø¨Ù„Ø§ØªÙŠÙ†</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="karat">Ø§Ù„Ø¹ÙŠØ§Ø±</label>
                                <select id="karat" required>
                                    <option value="18k">18 Ø¹ÙŠØ§Ø±</option>
                                    <option value="21k">21 Ø¹ÙŠØ§Ø±</option>
                                    <option value="22k">22 Ø¹ÙŠØ§Ø±</option>
                                    <option value="24k">24 Ø¹ÙŠØ§Ø±</option>
                                    <option value="925">925 (ÙØ¶Ø©)</option>
                                    <option value="950">950 (Ø¨Ù„Ø§ØªÙŠÙ†)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="color">Ù„ÙˆÙ† Ø§Ù„Ù…Ø¹Ø¯Ù†</label>
                                <select id="color">
                                    <option value="Yellow">Ø£ØµÙØ±</option>
                                    <option value="White">Ø£Ø¨ÙŠØ¶</option>
                                    <option value="Rose">ÙˆØ±Ø¯ÙŠ</option>
                                    <option value="Two-tone">Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù„ÙˆÙ†</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="shape">Ø§Ù„Ø´ÙƒÙ„ / Ø§Ù„Ù†Ù…Ø·</label>
                                <select id="shape">
                                    <option value="Classic">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</option>
                                    <option value="Modern">Ø¹ØµØ±ÙŠ</option>
                                    <option value="Vintage">Ø§Ù†ØªÙ‚ÙŠ</option>
                                    <option value="Minimalist">Ø¨Ø³ÙŠØ·</option>
                                    <option value="Ornate">Ù…Ø²Ø®Ø±Ù</option>
                                    <option value="Geometric">Ù‡Ù†Ø¯Ø³ÙŠ</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="gemstone_type">Ù†ÙˆØ¹ Ø§Ù„ÙØµ</label>
                                <select id="gemstone_type">
                                    <option value="None">Ø¨Ø¯ÙˆÙ† ÙØµ</option>
                                    <option value="Diamond">Ø£Ù„Ù…Ø§Ø³</option>
                                    <option value="Ruby">ÙŠØ§Ù‚ÙˆØª Ø£Ø­Ù…Ø±</option>
                                    <option value="Emerald">Ø²Ù…Ø±Ø±Ø¯</option>
                                    <option value="Sapphire">ÙŠØ§Ù‚ÙˆØª Ø£Ø²Ø±Ù‚</option>
                                    <option value="Pearl">Ù„Ø¤Ù„Ø¤</option>
                                    <option value="Amethyst">Ø¬Ù…Ø´Øª</option>
                                    <option value="Topaz">ØªÙˆØ¨Ø§Ø²</option>
                                </select>
                            </div>

                            <div class="form-group" id="gemstone-color-group" style="display: none;">
                                <label for="gemstone_color">Ù„ÙˆÙ† Ø§Ù„ÙØµ</label>
                                <select id="gemstone_color">
                                    <option value="White">Ø£Ø¨ÙŠØ¶</option>
                                    <option value="Red">Ø£Ø­Ù…Ø±</option>
                                    <option value="Blue">Ø£Ø²Ø±Ù‚</option>
                                    <option value="Green">Ø£Ø®Ø¶Ø±</option>
                                    <option value="Pink">ÙˆØ±Ø¯ÙŠ</option>
                                    <option value="Purple">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary form-submit">
                            ğŸ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…
                        </button>
                    </form>
                </div>

                <div class="design-result" id="design-result">
                    <div id="result-placeholder" style="text-align: center; color: #999;">
                        <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor" style="margin-bottom: 20px;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <p>ØªØµÙ…ÙŠÙ…Ùƒ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§</p>
                        <p style="font-size: 14px; margin-top: 10px;">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª ÙˆØ§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…"</p>
                    </div>
                    <div id="loading" style="display: none;">
                        <div class="loading-spinner">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</div>
                        <p style="margin-top: 20px; color: #666;">Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù</p>
                    </div>
                    <div id="result-content" style="display: none;">
                        <img id="result-image" src="" alt="Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆÙ„Ø¯">
                        <p id="design-id" style="margin-top: 15px; color: #666;"></p>
                        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                            <button class="btn btn-primary" onclick="requestJeweler()">Ø§Ø·Ù„Ø¨ Ù…Ù† ØµØ§Ø¦Øº</button>
                            <button class="btn btn-secondary" onclick="downloadDesign()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 60px;">
                <h3 class="section-title">ØªØµØ§Ù…ÙŠÙ…ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
                <div id="my-designs" class="products-grid">
                    <p style="text-align: center; color: #666; width: 100%;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø±Ø¤ÙŠØ© ØªØµØ§Ù…ÙŠÙ…Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2024 Hamdo - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
    </footer>

    <script src="js/api.js"></script>
    <script>
        let currentDesignId = null;

        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadMyDesigns();
            
            const gemstoneType = document.getElementById('gemstone_type');
            gemstoneType.addEventListener('change', function() {
                const colorGroup = document.getElementById('gemstone-color-group');
                colorGroup.style.display = this.value !== 'None' ? 'block' : 'none';
            });
        });

        function checkAuth() {
            if (isLoggedIn()) {
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'inline-block';
            } else {
                document.getElementById('login-btn').style.display = 'inline-block';
                document.getElementById('logout-btn').style.display = 'none';
            }
        }

        document.getElementById('ai-design-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!isLoggedIn()) {
                showToast('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµØ§Ù…ÙŠÙ…', 'error');
                setTimeout(() => window.location.href = 'login.html', 1500);
                return;
            }

            const designData = {
                type: document.getElementById('type').value,
                material: document.getElementById('material').value,
                karat: document.getElementById('karat').value,
                color: document.getElementById('color').value,
                shape: document.getElementById('shape').value,
                gemstone_type: document.getElementById('gemstone_type').value,
                gemstone_color: document.getElementById('gemstone_type').value !== 'None' 
                    ? document.getElementById('gemstone_color').value 
                    : null,
            };

            document.getElementById('result-placeholder').style.display = 'none';
            document.getElementById('result-content').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...';

            try {
                const result = await generateDesign(designData);
                
                currentDesignId = result.id;
                
                document.getElementById('result-image').src = BASE_URL + result.generated_image_url;
                document.getElementById('design-id').textContent = `Ø±Ù‚Ù… Ø§Ù„ØªØµÙ…ÙŠÙ…: #${result.id}`;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('result-content').style.display = 'block';
                
                showToast('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                loadMyDesigns();
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('result-placeholder').style.display = 'block';
                showToast(error.detail || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªØµÙ…ÙŠÙ…';
            }
        });

        async function loadMyDesigns() {
            if (!isLoggedIn()) return;

            const container = document.getElementById('my-designs');
            container.innerHTML = '<div class="loading-spinner">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµØ§Ù…ÙŠÙ…...</div>';

            try {
                const designs = await getMyDesigns();
                container.innerHTML = '';

                if (designs.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666; width: 100%;">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ ØªØµÙ…ÙŠÙ… Ø¨Ø¹Ø¯</p>';
                    return;
                }

                designs.forEach(design => {
                    const options = design.selected_options || {};
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <img src="${BASE_URL + design.generated_image_url}" alt="Design" class="product-image">
                        <div class="product-info">
                            <h3 class="product-name">${options.type || 'ØªØµÙ…ÙŠÙ…'} - ${options.material || ''}</h3>
                            <p class="product-meta">${options.karat || ''} | ${options.gemstone_type || 'Ø¨Ø¯ÙˆÙ† ÙØµ'}</p>
                            <p class="product-meta">${new Date(design.created_at).toLocaleDateString('ar-SA')}</p>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                container.innerHTML = '<p style="text-align: center; color: #666; width: 100%;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµØ§Ù…ÙŠÙ…</p>';
            }
        }

        function requestJeweler() {
            if (currentDesignId) {
                showToast('Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„ØµÙØ­Ø© Ø·Ù„Ø¨ Ø§Ù„ØªØµÙ…ÙŠÙ…...', 'success');
                setTimeout(() => {
                    window.location.href = `design-request.html?design_id=${currentDesignId}`;
                }, 1500);
            }
        }

        function downloadDesign() {
            const img = document.getElementById('result-image');
            const link = document.createElement('a');
            link.href = img.src;
            link.download = `hamdo-design-${currentDesignId}.png`;
            link.click();
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
